<?php

use App\ApplicationService\GuildMemberAppService;
use App\Domain\Course\RepositoryInterface\CourseRepositoryInterface;
use App\Domain\GuildMember\ValueObjects\StudentNumber;
use App\Domain\GuildMember\ValueObjects\Gender;
use App\Domain\GuildMember\ValueObjects\MailAddress;
use App\Domain\GuildMember\ValueObjects\LoginInfo;
use App\Domain\GuildMember\ValueObjects\PassWord;
use App\Domain\ProductionType\RepositoryInterface\ProductionTypeRepositoryInterface;

class PartyStoreTest extends \Tests\TestCase
{
    /* @var GuildMemberAppService $guildMemberAppService*/
    protected $guildMemberAppService;
    protected $productionTypeRepository;

    public function setUp()
    {
        parent::setUp(); // TODO: Change the autogenerated stub
        $this->productionTypeRepository = app(ProductionTypeRepositoryInterface::class);
        $this->guildMemberAppService = app(GuildMemberAppService::class);
        /* @var CourseRepositoryInterface $courseRepository */
        $courseRepository = app(CourseRepositoryInterface::class);
        $authData = $this->guildMemberAppService->registerMember(
            new StudentNumber('B4079'),
            '山崎 好洋',
            $courseRepository->all()[0],
            new Gender(Gender::MALE),
            new MailAddress('b4079@oic.jp'),
            new LoginInfo(new MailAddress('b4079@oic.jp'), new PassWord('12345678'))
        );
        $this->actingAs($authData);
    }

    public function testSuccess()
    {
        $data = [
            'party' => [
                'activityEndDate' => '2018-02-12',
                'productionIdea' => [
                    'productionTheme' => 'チーム開発を支援するサービス',
                    'productionTypeId' => $this->productionTypeRepository->all()[0]->id(),
                    'ideaDescription' => 'チーム内のコミュニティをITの力で円滑に進められるサービスを制作します',
                ],
                'wantedRoleList' => [
                    [
                        'remarks' => '技術が大好きな人を募集中',
                        'roleName' => 'サーバサイドエンジニア',
                        'referenceJobId' => 1,
                        'frameAmount' => 2,
                        'managerAssigned' => true,
                    ]
                ]
            ]
        ];

        $response = $this->post(route('store_party'), $data);

        $response->assertStatus(200);
}
}